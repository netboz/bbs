[
     {bbs, [
        {ontologies, [
          {<<"bbs:bubble">>, [{file, "ont_bbs_bubble.pl"}], [ont_bbs_bubble]},
          {<<"bbs:brain_tests">>, [{file, "ont_bbs_brain_test.pl"}], []},
          {<<"bbs:agent">>, [{file, "ont_bbs_agent.pl"}], [ont_bbs_agent]}
        ]}
        ]
    },
    {lager, [
        {log_root, "log"},
        {colored, true},
        {error_logger_hwm, 150},
        {handlers, [
            {lager_console_backend, [
                {level, debug},
                {formatter_config, [color,
                                    date, " ", time,
                                    " [", severity, "] ", pid, " ",
                                    {module, ["[", module, {line, [":", line], ""}, "] "], ""},
                                    message, "\n"
                                ]}
                                ]},

          {lager_file_backend, [{file, "error.log"}, {level, error}]},
          {lager_file_backend, [{file, "console.log"}, {level, info}]}
          ]}

      ]},
  {grpcbox, [{client, #{channels => [{default_channel, [{http, "localhost", 5000, []}], #{}}]}},
    {server, [#{
      grpc_opts => #{service_protos => [acc_service_pb],
        services => #{'eGem.acc_service' => e_gem_acc_service}},
      server_opts => #{header_table_size => 4096,
        enable_push => 1,
        max_concurrent_streams => unlimited,
        initial_window_size => 65535,
        max_frame_size => 16384,
        max_header_list_size => unlimited},
      listen_opts => #{port => 4242,
        ip => {0,0,0,0}}
    }]}]},
    {emq_dashboard, [{listeners_dash,[{http,18083,[{acceptors,4},{max_clients,512}]}]}]},
   %    {emq_modules, [{modules,[{emq_mod_presence,[{qos,1}]},
   %                             {emq_mod_subscription,[{<<"%u/%c/#">>,2}]},
   %                             {emq_mod_rewrite,[{rewrite,"x/#","^x/y/(.+)$","z/y/$1"},
   %                                               {rewrite,"y/+/z/#","^y/(.+)/z/(.+)$","y/z/$2"}]}]}]},
       {emqttd,
         [{plugins_loaded_file,"etc/loaded_plugins"},
          {plugins_etc_dir,"etc/plugins/"},
          {broker_sys_interval,60},
          {conn_force_gc_count,100},
          {cache_acl,true},
          {acl_file,"etc/acl.conf"},
          {allow_anonymous,true},
          {protocol,[{max_clientid_len,1024},{max_packet_size,262144}]},
          {client,[{client_idle_timeout,30000},{client_enable_stats,false}]},
          {session,
              [{upgrade_qos,false},
               {max_inflight,32},
               {retry_interval,20000},
               {max_awaiting_rel,100000},
               {await_rel_timeout,20000},
               {enable_stats,false},
               {expiry_interval,7200000}]},
          {queue,
              [{priority,[]},
               {type,simple},
               {max_length,infinity},
               {low_watermark,0.2},
               {high_watermark,0.6},
               {queue_qos0,true}]},
          {pubsub,[{pool_size,8},{by_clientid,true},{async,true}]},
          {bridge,[{max_queue_len,10000},{ping_down_interval,1}]},
          {listeners,
              [{tcp,1883,
                   [{connopts,[]},
                    {sockopts,[{backlog,1024},{nodelay,true}]},
                    {acceptors,8},
                    {max_clients,1024},
                    {tune_buffer,false}]},
               {ssl,8883,
                   [{sslopts,
                        [{versions,['tlsv1.2','tlsv1.1',tlsv1]},
                         {keyfile,"etc/certs/key.pem"},
                         {certfile,"etc/certs/cert.pem"}]},
                    {connopts,[]},
                    {sockopts,[{nodelay,true}]},
                    {acceptors,4},
                    {max_clients,512}]},
               {http,8083,
                   [{connopts,[]},
                    {sockopts,[{nodelay,true}]},
                    {acceptors,4},
                    {max_clients,64}]},
               {https,8084,
                   [{sslopts,
                        [{keyfile,"etc/certs/key.pem"},
                         {certfile,"etc/certs/cert.pem"}]},
                    {connopts,[]},
                    {sockopts,[{nodelay,true}]},
                    {acceptors,4},
                    {max_clients,64}]}]},
          {sysmon,
              [{long_gc,false},
               {long_schedule,240},
               {large_heap,8388608},
               {busy_port,false},
               {busy_dist_port,true}]}]}
].
