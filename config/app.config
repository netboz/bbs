[
  {bbs, [
    {ontologies, [
      {<<"bbs:root">>, [{file, "ont_bbs_root.pl"}], []},
      {<<"bbs:bubble">>, [{file, "ont_bbs_bubble.pl"}], [ont_bbs_bubble]},
      {<<"bbs:brain_tests">>, [{file, "ont_bbs_brain_test.pl"}], []},
      {<<"bbs:brain_tests:data">>, [{file, "ont_bbs_brain_test_data.pl"}], []},
      {<<"bbs:agent">>, [{file, "ont_bbs_agent.pl"}], [ont_bbs_agent]},
      {<<"bbs:mts:mqtt:broker">>, [{file, "ont_bbs_mts_mqtt_broker.pl"}], [ont_bbs_mts_mqtt_broker]},
      {<<"bbs:mts:mqtt:client">>, [{file, "ont_bbs_mts_mqtt_client.pl"}], [ont_bbs_mts_mqtt_client]}
    ]}
  ]
  },
  {emqx,
    [
      {allow_anonymous, true},
      {acl_nomatch, allow},
      {plugins_etc_dir, "etc/plugins"},
      {plugins_loaded_file, "data/loaded_plugins"},
      {listeners, [
        #{proto => tcp,
          name => <<"simple_open_listener">>,
          listen_on => {"0.0.0.0", 1883},
          opts => [{access, [{allow, all}]}]}
      ]},
      %% TODO :Not sure next entry have good format
      {log, [ {level, debug}, {logdir, "log"}]},
      {plugins, [
        {plugins_etc_dir, "etc/plugins"},
        {plugins_loaded_file, "data/loaded_plugins"}]},
      {alarm, [
        {validity_period, 86400},
        {size_limit, 1000},
        {actions, [log, publish]}
      ]},
      {mqtt, [
        {max_packet_size, 1048576},
        {max_clientid_len, 65535},
        {max_topic_levels, 0},
        {max_qos_allowed, 2},
        {max_topic_alias, 65535},
        {retain_available, true},
        {wildcard_subscription, true},
        {shared_subscription, true},
        {ignore_loop_deliver, false},
        {strict_mode, false}
      ]},
      {broker, [
        {sys_interval, 60000},
        {sys_heartbet, 30000},
        {session_locking_strategy, quorum},
        {shared_subscription_strategy, random},
        {shared_dispatch_ack_enabled , false},
        {route_batch_clean, false}]},
      {sysmon, [
        {long_gc, 0},
        {long_schedule, 240},
        {large_heap, 8388608},
        {busy_port, false},
        {busy_dist_port, true}]},
      {os_mon, [
        {cpu_check_interval, 60000},
        {cpu_high_watermark, 0.8},
        {cpu_low_watermark, 0.6},
        {mem_check_interval, 60000},
        {sysmem_high_watermark, 0.7},
        {procmem_high_watermark, 0.05},
        {check_interval, 30000},
        {process_high_watermark, 0.80},
        {process_low_watermark, 0.6}]},
      {vm_mon, [
        {check_interval, 30000},
        {process_high_watermark, 0.8},
        {process_low_watermark, 0.6}]}
    ]},
  {lager, [
    {log_root, "log"},
    {colored, true},
    {error_logger_hwm, 150},
    {handlers, [
      {lager_console_backend, [
        {level, debug},
        {formatter_config, [color,
          date, " ", time,
          " [", severity, "] ", pid, " ",
          {module, ["[", module, {line, [":", line], ""}, "] "], ""},
          message, "\n"
        ]}
      ]},

      {lager_file_backend, [{file, "error.log"}, {level, error}]},
      {lager_file_backend, [{file, "console.log"}, {level, info}]}
    ]}

  ]},
  {grpcbox, [{client, #{channels => [{default_channel, [{http, "localhost", 5000, []}], #{}}]}},
    {server, [#{
      grpc_opts => #{service_protos => [acc_service_pb],
        services => #{'eGem.acc_service' => e_gem_acc_service}},
      server_opts => #{header_table_size => 4096,
        enable_push => 1,
        max_concurrent_streams => unlimited,
        initial_window_size => 65535,
        max_frame_size => 16384,
        max_header_list_size => unlimited},
      listen_opts => #{port => 4242,
        ip => {0,0,0,0}}
    }]}]},
  {emq_dashboard, [{listeners_dash,[{http,18083,[{acceptors,4},{max_clients,512}]}]}]},
  %    {emq_modules, [{modules,[{emq_mod_presence,[{qos,1}]},
  %                             {emq_mod_subscription,[{<<"%u/%c/#">>,2}]},
  %                             {emq_mod_rewrite,[{rewrite,"x/#","^x/y/(.+)$","z/y/$1"},
  %                                               {rewrite,"y/+/z/#","^y/(.+)/z/(.+)$","y/z/$2"}]}]}]},
  {emqttd,
    [{plugins_loaded_file,"etc/loaded_plugins"},
      {plugins_etc_dir,"etc/plugins/"},
      {broker_sys_interval,60},
      {conn_force_gc_count,100},
      {cache_acl,true},
      {acl_file,"etc/acl.conf"},
      {allow_anonymous,true},
      {protocol,[{max_clientid_len,1024},{max_packet_size,262144}]},
      {client,[{client_idle_timeout,30000},{client_enable_stats,false}]},
      {session,
        [{upgrade_qos,false},
          {max_inflight,32},
          {retry_interval,20000},
          {max_awaiting_rel,100000},
          {await_rel_timeout,20000},
          {enable_stats,false},
          {expiry_interval,7200000}]},
      {queue,
        [{priority,[]},
          {type,simple},
          {max_length,infinity},
          {low_watermark,0.2},
          {high_watermark,0.6},
          {queue_qos0,true}]},
      {pubsub,[{pool_size,8},{by_clientid,true},{async,true}]},
      {bridge,[{max_queue_len,10000},{ping_down_interval,1}]},
      {listeners,
        [{tcp,1883,
          [{connopts,[]},
            {sockopts,[{backlog,1024},{nodelay,true}]},
            {acceptors,8},
            {max_clients,1024},
            {tune_buffer,false}]},
          {ssl,8883,
            [{sslopts,
              [{versions,['tlsv1.2','tlsv1.1',tlsv1]},
                {keyfile,"etc/certs/key.pem"},
                {certfile,"etc/certs/cert.pem"}]},
              {connopts,[]},
              {sockopts,[{nodelay,true}]},
              {acceptors,4},
              {max_clients,512}]},
          {http,8083,
            [{connopts,[]},
              {sockopts,[{nodelay,true}]},
              {acceptors,4},
              {max_clients,64}]},
          {https,8084,
            [{sslopts,
              [{keyfile,"etc/certs/key.pem"},
                {certfile,"etc/certs/cert.pem"}]},
              {connopts,[]},
              {sockopts,[{nodelay,true}]},
              {acceptors,4},
              {max_clients,64}]}]},
      {sysmon,
        [{long_gc,false},
          {long_schedule,240},
          {large_heap,8388608},
          {busy_port,false},
          {busy_dist_port,true}]}]}
].
